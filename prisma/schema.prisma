generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Unit {
  kg
  g
  litre
  piece
  dozen
}

enum Role {
  Admin
  Seller
  Customer
}

model User {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name          String
  email         String  @unique
  emailVerified Boolean @default(false)
  image         String?
  role          Role    @default(Customer)
  phone         String

  customerProfile CustomerProfile?
  sellerProfile   SellerProfile?

  sessions Session[]
  accounts Account[]

  @@map("users")
}

model CustomerProfile {
  id        String @id @default(uuid())
  user      User   @relation(fields: [userId], references: [id])
  userId    String @unique

  address  String
}

model SellerProfile {
  id     String @id @default(uuid())
  user   User   @relation(fields: [userId], references: [id])
  userId String @unique

  storeName String
  // documents   Json? // government verified docs
  // rating      Float? // average rating
  products    Product[]
}

model Session {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  expiresAt DateTime
  token     String   @unique
  ipAddress String?
  userAgent String?

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

model Account {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  accountId             String
  providerId            String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("accounts")
}

model Verification {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  identifier String
  value      String
  expiresAt  DateTime

  @@index([identifier])
  @@map("verifications")
}


model Tag {
  id    String  @id @default(uuid())

  label String
  value String

  productId String
  product Product @relation(fields: [productId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Image {
  id String @id @default(uuid())
  url String
  fileId String
  productId String
  product Product @relation(fields: [productId], references: [id])
}

model Product {
  id            String   @id @default(uuid())

  title         String
  description   String
  price         Float
  unit          Unit?
  inventory     Int      @default(0)
  deliveryTime  Int       @default(5)
  discount      Int       @default(0)

  images        Image[]

  tags          Tag[]

  sellerProfileId String
  sellerProfile   SellerProfile @relation(fields: [sellerProfileId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
// model Product {
//   id          String   @id @default(uuid())
//   name        String
//   slug        String   @unique
//   description String
//   price       Float
//   unit        Unit
//   stock       Int      @default(0)
//   images      String[]
//   isOrganic   Boolean  @default(false)
//   tags        String[]
//   isPublished Boolean  @default(true)
//   discount    Int      @default(0)
//   sku         String   @unique

//   sellerProfileId String
//   sellerProfile   SellerProfile @relation(fields: [sellerProfileId], references: [id])

//   categoryId String
//   category   Category @relation(fields: [categoryId], references: [id])

//   ratings       Rating[]
//   averageRating Float    @default(0)

//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt
// }

model Rating {
  id        String   @id @default(uuid())
  rating    Int
  review    String?
  createdAt DateTime @default(now())

  // customerProfileId String
  // customerProfile   CustomerProfile @relation(fields: [customerProfileId], references: [id])

  // productId String
  // product   Product @relation(fields: [productId], references: [id])
}

model Category {
  id          String  @id @default(uuid())
  name        String
  slug        String  @unique
  image       String?
  description String?

  parentId String?
  parent   Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children Category[] @relation("CategoryHierarchy")

  // products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}







// model SellerProfile {
//   id                String   @id @default(cuid())

//   // Relations
//   userId            String   @unique
//   user              User     @relation(fields: [userId], references: [id])

//   // Business Identity
//   shopName          String
//   shopSlug          String   @unique
//   description       String?
//   category          String   // vegetables, fruits, grains, dairy, etc.

//   // Verification
//   isVerified        Boolean  @default(false)
//   verificationStatus SellerVerificationStatus @default(PENDING)

//   // Contact
//   phone             String
//   email             String?
//   supportEmail      String?

//   // Address
//   addressLine1      String
//   addressLine2      String?
//   city              String
//   state             String
//   country           String
//   pincode           String

//   // Media
//   logoUrl           String?
//   bannerUrl         String?

//   // Business Details
//   gstNumber         String?
//   panNumber         String?
//   licenseNumber     String?

//   // Metrics (derived, cached)
//   totalProducts     Int      @default(0)
//   totalOrders       Int      @default(0)
//   rating            Float    @default(0)

//   // Status
//   isActive          Boolean  @default(true)

//   createdAt         DateTime @default(now())
//   updatedAt         DateTime @updatedAt
// }

// enum SellerVerificationStatus {
//   PENDING
//   VERIFIED
//   REJECTED
// }


// export const sellerProfileSchema = z.object({
//   shopName: z.string().min(3),
//   description: z.string().optional(),
//   category: z.string(),

//   phone: z.string().min(10),
//   email: z.string().email().optional(),

//   addressLine1: z.string(),
//   addressLine2: z.string().optional(),
//   city: z.string(),
//   state: z.string(),
//   country: z.string(),
//   pincode: z.string(),

//   gstNumber: z.string().optional(),
//   panNumber: z.string().optional(),
//   licenseNumber: z.string().optional(),
// });



// model CustomerProfile {
//   id                String   @id @default(cuid())

//   // Relations
//   userId            String   @unique
//   user              User     @relation(fields: [userId], references: [id])

//   // Personal Info
//   fullName          String
//   phone             String
//   email             String?

//   // Preferences
//   preferredLanguage String?
//   notificationOptIn Boolean  @default(true)

//   // Default Address
//   addressLine1      String
//   addressLine2      String?
//   city              String
//   state             String
//   country           String
//   pincode           String

//   // Metrics
//   totalOrders       Int      @default(0)
//   totalSpent        Float    @default(0)

//   // Status
//   isActive          Boolean  @default(true)

//   createdAt         DateTime @default(now())
//   updatedAt         DateTime @updatedAt
// }


// export const customerProfileSchema = z.object({
//   fullName: z.string().min(2),
//   phone: z.string().min(10),
//   email: z.string().email().optional(),

//   addressLine1: z.string(),
//   addressLine2: z.string().optional(),
//   city: z.string(),
//   state: z.string(),
//   country: z.string(),
//   pincode: z.string(),

//   preferredLanguage: z.string().optional(),
// });
